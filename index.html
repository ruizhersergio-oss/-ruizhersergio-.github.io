<!DOCTYPE html>
<html lang="es-ES">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Restaurante La Clave Daimiel | Cocina Manchega Casera y Tradicional</title>
    <meta name="description" content="Restaurante La Clave en Daimiel, Ciudad Real. Cocina casera manchega con productos locales. Especialidades: arroz con bogavante, pisto manchego, carpaccio de bacalao. Reservas: 669 67 09 85">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600&family=Montserrat:wght@600;700;800&display=swap" rel="stylesheet">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { font-family: 'IBM Plex Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; line-height: 1.6; color: #333; overflow-x: hidden; }
        h1, h2 { font-family: 'Halyard Display', 'Montserrat', sans-serif; font-weight: 700; letter-spacing: -0.5px; }
        h3, h4 { font-family: 'Futura', 'Century Gothic', sans-serif; font-weight: 400; letter-spacing: 0.5px; }

        header { background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%); color: white; padding: 1rem 0; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        nav { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 1rem; flex-wrap: wrap; gap: 0.5rem; }
        .logo { font-family: 'Halyard Display', 'Montserrat', sans-serif; font-size: clamp(1.3rem, 4vw, 1.8rem); font-weight: 800; letter-spacing: 3px; animation: fadeInDown 0.8s ease-out; }
        .nav-links { display: flex; list-style: none; gap: clamp(0.5rem, 2vw, 2rem); flex-wrap: nowrap; align-items: center; }
        .nav-links li { opacity: 0; animation: fadeInUp 0.6s ease-out forwards; }
        .nav-links li:nth-child(1) { animation-delay: 0.1s; }
        .nav-links li:nth-child(2) { animation-delay: 0.2s; }
        .nav-links li:nth-child(3) { animation-delay: 0.3s; }
        .nav-links li:nth-child(4) { animation-delay: 0.4s; }
        .nav-links li:nth-child(5) { animation-delay: 0.5s; }
        .nav-links a { color: white; text-decoration: none; font-size: clamp(0.8rem, 2vw, 1.05rem); font-weight: 500; transition: all 0.3s ease; position: relative; padding: 0.5rem clamp(0.3rem, 1.5vw, 1rem); border-radius: 5px; display: block; white-space: nowrap; }
        .nav-links a::before { content: ''; position: absolute; bottom: 0; left: 50%; width: 0; height: 2px; background: #FFD700; transition: all 0.3s ease; transform: translateX(-50%); }
        .nav-links a:hover { color: #FFD700; background: rgba(255, 215, 0, 0.1); transform: translateY(-2px); }
        .nav-links a:hover::before { width: 80%; }

        .admin-btn-float { position: fixed; bottom: 30px; left: 30px; background: rgba(139, 69, 19, 0.95); color: white; padding: 0.7rem 1.5rem; border-radius: 50px; font-size: 0.9rem; font-weight: 600; cursor: pointer; z-index: 1000; box-shadow: 0 4px 15px rgba(0,0,0,0.3); transition: all 0.3s ease; border: 2px solid #FFD700; text-decoration: none; display: flex; align-items: center; gap: 0.5rem; opacity: 1; }
        .admin-btn-float:hover { background: rgba(160, 82, 45, 0.95); transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.4); }

        .admin-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); z-index: 10002; overflow-y: auto; animation: fadeIn 0.3s ease; }
        .admin-modal.show { display: block; }
        .admin-modal-content { max-width: 1200px; margin: 0 auto; padding: 2rem; color: white; }
        .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(255,215,0,0.3); }
        .admin-header h2 { color: white; font-size: 2rem; }
        .close-admin-btn { background: transparent; border: 2px solid white; color: white; padding: 0.8rem 1.5rem; border-radius: 50px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .close-admin-btn:hover { background: rgba(255,255,255,0.1); transform: scale(1.05); }

        .admin-login { max-width: 400px; margin: 0 auto; background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); margin-top: 5rem; }
        .admin-login h3 { color: #8B4513; margin-bottom: 1.5rem; text-align: center; }
        .pin-input { width: 100%; padding: 1rem; font-size: 1.5rem; text-align: center; letter-spacing: 1rem; border: 2px solid #ddd; border-radius: 10px; margin-bottom: 1rem; }
        .admin-content { display: none; }
        .admin-content.active { display: block; }

        .admin-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card { background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center; }
        .stat-card h3 { color: #8B4513; font-size: 2rem; margin-bottom: 0.5rem; }
        .stat-card p { color: #666; font-size: 0.9rem; }
        .stat-card.warning { background: #fff3cd; border-left: 4px solid #ffc107; }
        .stat-card.warning h3 { color: #ff9800; }

        .admin-upload-section { background: #f8f9fa; padding: 1.5rem; border-radius: 10px; margin-bottom: 2rem; border: 2px solid #8B4513; }
        .upload-label { display: block; background: #8B4513; color: white; padding: 1rem; border-radius: 8px; cursor: pointer; text-align: center; margin-bottom: 1rem; transition: 0.3s; font-weight: 600; }
        .upload-label:hover { background: #A0522D; }
        .upload-label.uploading { background: #666; cursor: wait; }
        input[type="file"] { display: none; }

        .menu-gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .menu-gallery-item { position: relative; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.2); transition: transform 0.3s; }
        .menu-gallery-item:hover { transform: scale(1.05); }
        .menu-gallery-item img { width: 100%; height: 150px; object-fit: cover; display: block; }
        .menu-gallery-item .delete-img-btn { position: absolute; top: 5px; right: 5px; background: #f44336; color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-size: 1rem; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }
        .menu-gallery-item .delete-img-btn:hover { background: #d32f2f; }
        .menu-gallery-item .active-badge { position: absolute; top: 5px; left: 5px; background: #4caf50; color: white; padding: 0.3rem 0.6rem; border-radius: 5px; font-size: 0.75rem; font-weight: 600; }
        .no-menus-msg { text-align: center; padding: 2rem; color: #999; font-style: italic; }

        .calendar-container { background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-bottom: 2rem; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .calendar-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; }

        .calendar-day-card { border: 2px solid #ddd; border-radius: 10px; overflow: hidden; cursor: pointer; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .calendar-day-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.2); }
        .calendar-day-card.selected { border: 3px solid #FFD700; box-shadow: 0 0 20px rgba(255, 215, 0, 0.6); }

        .calendar-day-header { background: #8B4513; color: white; padding: 0.5rem; text-align: center; font-weight: 600; }
        .calendar-day-header strong { font-size: 1.3rem; display: block; }
        .calendar-day-header small { font-size: 0.8rem; opacity: 0.9; }

        .calendar-turnos { display: flex; flex-direction: column; }
        .turno-status { padding: 1rem 0.5rem; text-align: center; font-size: 0.85rem; font-weight: 600; border-bottom: 1px solid #ddd; }
        .turno-status:last-child { border-bottom: none; }
        .turno-status.available { background: #c8e6c9; color: #1b5e20; }
        .turno-status.partial { background: #ffe0b2; color: #e65100; }
        .turno-status.full { background: #ffcdd2; color: #c62828; }

        .day-reservations { background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-bottom: 2rem; display: none; }
        .day-reservations.show { display: block; }
        .day-reservations h3 { color: #8B4513; margin-bottom: 1.5rem; font-size: 1.5rem; }

        .turno-section { margin-bottom: 2rem; }
        .turno-section h4 { color: #8B4513; font-size: 1.2rem; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid #FFD700; }

        .reservation-mini { background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem; border-left: 4px solid #8B4513; display: flex; justify-content: space-between; align-items: center; gap: 1rem; }
        .reservation-mini.pendiente { background: #fff8e1; border-left-color: #ff9800; }
        .reservation-mini.confirmada { background: #e8f5e9; border-left-color: #4caf50; }

        .estado-badge { padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.75rem; font-weight: 600; white-space: nowrap; }
        .estado-badge.pendiente { background: #fff3cd; color: #ff9800; border: 1px solid #ff9800; }
        .estado-badge.confirmada { background: #d4edda; color: #28a745; border: 1px solid #28a745; }

        .confirm-btn { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; padding: 0.5rem 1rem; border-radius: 50px; cursor: pointer; transition: all 0.3s; font-weight: 600; font-size: 0.85rem; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3); }
        .confirm-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4); }

        .reservations-list { background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .reservation-item { padding: 1rem; border-left: 4px solid #8B4513; background: #ffffff; margin-bottom: 1rem; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .reservation-item.pendiente { background: #fff8e1; border-left-color: #ff9800; }
        .reservation-item.confirmada { background: #e8f5e9; border-left-color: #4caf50; }

        .delete-btn { background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%); color: white; border: none; padding: 0.7rem 1.2rem; border-radius: 50px; cursor: pointer; transition: all 0.3s; font-weight: 600; box-shadow: 0 4px 10px rgba(244, 67, 54, 0.3); }
        .delete-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(244, 67, 54, 0.4); }

        .add-manual-btn { background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%); color: white; padding: 1rem 2rem; border: none; border-radius: 50px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; margin-bottom: 2rem; display: block; margin-left: auto; margin-right: auto; }
        .add-manual-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(139, 69, 19, 0.4); }

        .submit-btn { width: 100%; background: linear-gradient(135deg, #25D366 0%, #20BA5A 100%); color: white; padding: 1rem 2rem; border: none; border-radius: 50px; font-size: clamp(1rem, 2.5vw, 1.1rem); font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-top: 1rem; }
        .submit-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(37, 211, 102, 0.4); }
        .cancel-btn { width: 100%; background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%); color: white; padding: 1rem 2rem; border: none; border-radius: 50px; font-size: clamp(1rem, 2.5vw, 1.1rem); font-weight: 600; cursor: pointer; transition: all 0.3s; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10003; overflow-y: auto; }
        .modal.show { display: flex; align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 2rem; border-radius: 15px; max-width: 600px; width: 90%; margin: 2rem; max-height: 90vh; overflow-y: auto; }

        .phone-group { display: flex; gap: 0.5rem; }
        .prefix-select { width: 120px; padding: 0.8rem 0.5rem; border: 2px solid #ddd; border-radius: 8px; font-size: clamp(0.95rem, 2vw, 1rem); font-family: inherit; transition: border-color 0.3s; }
        .phone-input { flex: 1; }

        .loading-spinner { display: inline-block; width: 20px; height: 20px; border: 3px solid rgba(255,255,255,.3); border-radius: 50%; border-top-color: white; animation: spin 1s ease-in-out infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .hero { background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=1600&q=80'); background-size: cover; background-position: center; min-height: 500px; height: 70vh; display: flex; align-items: center; justify-content: center; text-align: center; color: white; padding: 2rem; }
        .hero-content h1 { font-size: clamp(2rem, 5vw, 3.5rem); margin-bottom: 1rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.7); font-weight: 800; }
        .hero-content p { font-size: clamp(1.1rem, 3vw, 1.5rem); margin-bottom: 2rem; text-shadow: 1px 1px 3px rgba(0,0,0,0.7); max-width: 600px; margin-left: auto; margin-right: auto; }
        .cta-button { background: #FFD700; color: #333; padding: 1rem 2.5rem; text-decoration: none; font-size: clamp(1rem, 2.5vw, 1.2rem); font-weight: 600; border-radius: 50px; transition: transform 0.3s, box-shadow 0.3s; display: inline-block; }
        .cta-button:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(255,215,0,0.4); }

        section { max-width: 1200px; margin: 0 auto; padding: clamp(2rem, 5vw, 4rem) clamp(1rem, 3vw, 2rem); scroll-margin-top: 80px; }
        h2 { font-size: clamp(2.2rem, 5vw, 2.8rem); color: #8B4513; margin-bottom: 2rem; text-align: center; position: relative; padding-bottom: 1rem; }
        h2::after { content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 100px; height: 3px; background: #FFD700; }

        .reserva { background: linear-gradient(135deg, #FFF8DC 0%, #FAEBD7 100%); }
        .reserva-container { max-width: 600px; margin: 0 auto; background: white; padding: clamp(2rem, 4vw, 3rem); border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; color: #8B4513; font-weight: 600; font-size: clamp(1rem, 2.5vw, 1.1rem); }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 0.8rem 1rem; border: 2px solid #ddd; border-radius: 8px; font-size: clamp(0.95rem, 2vw, 1rem); font-family: inherit; transition: border-color 0.3s; }
        .form-group textarea { resize: vertical; min-height: 100px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }

        .menu { background: #FFF8DC; }
        .menu-preview-container { text-align: center; margin-top: 2rem; border: 3px dashed #8B4513; padding: 1rem; border-radius: 15px; background: #fff; }
        .menu-img-display { max-width: 100%; height: auto; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); display: none; margin-top: 1rem; }
        .no-menu-msg { padding: 1.5rem 1rem; color: #777; font-style: italic; font-size: 0.95rem; }

        .whatsapp-float { position: fixed; bottom: 30px; right: 30px; background: #25D366; color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3); cursor: pointer; transition: transform 0.3s; z-index: 1000; text-decoration: none; }
        .whatsapp-float:hover { transform: scale(1.1); }

        footer { background: #8B4513; color: white; text-align: center; padding: 2rem 1rem; }

        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        @media (max-width: 768px) {
            .form-row { grid-template-columns: 1fr; }
            .phone-group { flex-direction: column; }
            .prefix-select { width: 100%; }
            .calendar-grid { grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 0.5rem; }
            .menu-gallery { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); }
        }
    </style>
</head>
<body>
    <button class="admin-btn-float" onclick="abrirModalAdmin()"><span>üë§</span><span>Admin</span></button>

    <div class="admin-modal" id="adminModal">
        <div class="admin-modal-content">
            <div class="admin-header">
                <h2>üë§ Panel de Administraci√≥n</h2>
                <button class="close-admin-btn" onclick="cerrarModalAdmin()">‚úñ Cerrar</button>
            </div>

            <div class="admin-login" id="adminLogin">
                <h3>üîê Acceso Restringido</h3>
                <p style="text-align: center; color: #666; margin-bottom: 1rem;">Introduce el PIN de acceso</p>
                <input type="password" class="pin-input" id="pinInput" maxlength="4" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeypress="if(event.key==='Enter') verificarPIN()">
                <button type="button" class="submit-btn" onclick="verificarPIN()">Acceder</button>
            </div>

            <div class="admin-content" id="adminContent">
                <div class="admin-stats">
                    <div class="stat-card warning"><h3 id="reservasPendientes">0</h3><p>üü° Pendientes de Confirmar</p></div>
                    <div class="stat-card"><h3 id="reservasConfirmadas">0</h3><p>üü¢ Confirmadas</p></div>
                    <div class="stat-card"><h3 id="reservasHoy">0</h3><p>Reservas Hoy</p></div>
                    <div class="stat-card"><h3 id="ingresosEstimados">0‚Ç¨</h3><p>Ingresos Estimados</p></div>
                </div>

                <div class="admin-upload-section">
                    <h3 style="color:#8B4513; margin-bottom:1rem;">üì∏ Gesti√≥n de Men√∫s del D√≠a</h3>

                    <label for="menuFile" class="upload-label" id="uploadLabel">
                        <span id="uploadText">üì§ Subir nueva foto del men√∫</span>
                    </label>
                    <input type="file" id="menuFile" accept="image/*" onchange="subirFotoMenu(this)">

                    <p style="font-size:0.85rem; color:#555; margin-bottom:1rem;">
                        La foto se guarda en la nube y se ver√° en todos los dispositivos (m√≥vil, tablet, ordenador).
                    </p>

                    <div id="statusMessage" style="display:none; padding:0.8rem; border-radius:5px; margin-bottom:1rem; font-size:0.9rem;"></div>

                    <h4 style="color:#8B4513; margin-top:1.5rem; margin-bottom:0.8rem;">üìÇ Fotos actuales del men√∫:</h4>
                    <div class="menu-gallery" id="menuGallery"></div>
                </div>

                <button class="add-manual-btn" onclick="abrirModalReserva()">‚ûï A√±adir Reserva Manual</button>

                <div class="calendar-container">
                    <div class="calendar-header"><h3 style="color: #8B4513;">üìÖ Calendario de Reservas</h3></div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>

                <div class="day-reservations" id="dayReservations">
                    <h3 id="dayTitle">Reservas del d√≠a</h3>
                    <div class="turno-section"><h4>üåÖ Mediod√≠a</h4><div id="reservasMediodia"></div></div>
                    <div class="turno-section"><h4>üåô Cena</h4><div id="reservasNoche"></div></div>
                </div>

                <div class="reservations-list">
                    <h3 style="color: #8B4513; margin-bottom: 1.5rem;">üìã Todas las Reservas</h3>
                    <div id="reservationsList"></div>
                </div>
            </div>
        </div>
    </div>

    <header role="banner">
        <nav role="navigation">
            <div class="logo">LA CLAVE</div>
            <ul class="nav-links">
                <li><a href="#inicio">Inicio</a></li>
                <li><a href="#reserva">Reservar</a></li>
                <li><a href="#menu">Men√∫</a></li>
                <li><a href="#contacto">Contacto</a></li>
            </ul>
        </nav>
    </header>

    <section id="inicio" class="hero">
        <div class="hero-content">
            <div>
                <h1>Restaurante La Clave</h1>
                <p>Cocina casera manchega con pasi√≥n y tradici√≥n</p>
                <a href="#reserva" class="cta-button">Reserva tu Mesa</a>
            </div>
        </div>
    </section>

    <section id="reserva" class="reserva">
        <h2>üçΩÔ∏è Reserva tu Mesa</h2>
        <div class="reserva-container">
            <form id="reservaForm" onsubmit="enviarReserva(event)">
                <div class="form-group">
                    <label for="nombre">üë§ Nombre completo *</label>
                    <input type="text" id="nombre" name="nombre" required placeholder="Ej: Juan Garc√≠a">
                </div>

                <div class="form-group">
                    <label for="telefono">‚òéÔ∏è Tel√©fono de contacto *</label>
                    <div class="phone-group">
                        <select id="prefijo" name="prefijo" class="prefix-select" required>
                            <option value="+34" selected>üá™üá∏ +34</option>
                            <option value="+33">üá´üá∑ +33</option>
                            <option value="+44">üá¨üáß +44</option>
                        </select>
                        <input type="tel" id="telefono" name="telefono" class="phone-input" required placeholder="600123456" pattern="[0-9]{9}" title="Introduce 9 d√≠gitos" maxlength="9">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="fecha">üìÖ Fecha *</label>
                        <input type="date" id="fecha" name="fecha" required onchange="actualizarHorasDisponibles()">
                    </div>
                    <div class="form-group">
                        <label for="hora">üïê Hora *</label>
                        <select id="hora" name="hora" required><option value="">Selecciona hora</option></select>
                        <div id="availabilityInfo"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="personas">üë• N√∫mero de personas *</label>
                    <select id="personas" name="personas" required>
                        <option value="">Selecciona</option>
                        <option value="2">2 personas</option>
                        <option value="3">3 personas</option>
                        <option value="4">4 personas</option>
                        <option value="5">5 personas</option>
                        <option value="6">6 personas</option>
                        <option value="mas8">M√°s de 8</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="comentarios">üí¨ Comentarios (opcional)</label>
                    <textarea id="comentarios" name="comentarios"></textarea>
                </div>

                <button type="submit" class="submit-btn">Reservar por WhatsApp</button>
            </form>
        </div>
    </section>

    <section id="menu" class="menu">
        <h2>Men√∫ del D√≠a</h2>
        <div class="menu-preview-container">
            <h3 style="color:#8B4513; margin-bottom:1rem;">üì∑ Men√∫ del d√≠a de hoy</h3>
            <img id="menuDiarioImg" class="menu-img-display" alt="Men√∫ del d√≠a Restaurante La Clave">
            <div id="noMenuMsg" class="no-menu-msg">Hoy el men√∫ del d√≠a se confirma en sala. Preg√∫ntanos por WhatsApp.</div>
        </div>
    </section>

    <section id="contacto">
        <h2>Contacto</h2>
        <p style="text-align:center;">üìç Daimiel | üì± 669 67 09 85</p>
    </section>

    <a href="https://wa.me/34669670985" class="whatsapp-float" target="_blank" rel="noopener noreferrer">
        <span style="font-size:28px;">üí¨</span>
    </a>

    <footer>
        <p>&copy; 2026 Restaurante La Clave</p>
    </footer>

    <script>
        const CAPACIDAD_MEDIODIA = 15;
        const CAPACIDAD_NOCHE = 15;
        const UMBRAL_NARANJA = 7;
        const UMBRAL_ROJO = 10;
        const PIN_ADMIN = '1234';
        const IMGBB_API_KEY = '27e3eb7e3f3e9e5f7d6c8a5c97ad8d21'; // API KEY de ImgBB (ejemplo - c√°mbiala)

        function abrirModalAdmin() {
            document.getElementById('adminModal').classList.add('show');
            document.body.style.overflow = 'hidden';
            document.getElementById('pinInput').focus();
        }
        function cerrarModalAdmin() {
            document.getElementById('adminModal').classList.remove('show');
            document.body.style.overflow = 'auto';
            document.getElementById('adminLogin').style.display = 'block';
            document.getElementById('adminContent').classList.remove('active');
            document.getElementById('pinInput').value = '';
            document.getElementById('dayReservations').classList.remove('show');
        }
        function verificarPIN() {
            const pin = document.getElementById('pinInput').value;
            if (pin === PIN_ADMIN) {
                document.getElementById('adminLogin').style.display = 'none';
                document.getElementById('adminContent').classList.add('active');
                cargarDatosAdmin();
                cargarGaleriaMenus();
            } else {
                alert('‚ùå PIN incorrecto');
                document.getElementById('pinInput').value = '';
                document.getElementById('pinInput').focus();
            }
        }

        function obtenerReservas() {
            const reservas = localStorage.getItem('reservas');
            return reservas ? JSON.parse(reservas) : [];
        }
        function guardarReservas(reservas) {
            localStorage.setItem('reservas', JSON.stringify(reservas));
        }

        // SISTEMA DE MEN√ö EN LA NUBE (ImgBB)
        function obtenerMenus() {
            const menus = localStorage.getItem('menusCloud');
            return menus ? JSON.parse(menus) : [];
        }
        function guardarMenus(menus) {
            localStorage.setItem('menusCloud', JSON.stringify(menus));
        }

        async function subirFotoMenu(input) {
            if (!input.files || !input.files[0]) return;

            const file = input.files[0];
            const uploadLabel = document.getElementById('uploadLabel');
            const uploadText = document.getElementById('uploadText');
            const statusMsg = document.getElementById('statusMessage');

            // UI: Mostrar cargando
            uploadLabel.classList.add('uploading');
            uploadText.innerHTML = '<span class="loading-spinner"></span> Subiendo foto...';
            statusMsg.style.display = 'none';

            try {
                // Crear FormData para enviar a ImgBB
                const formData = new FormData();
                formData.append('image', file);

                const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    // Guardar la URL en localStorage
                    const menus = obtenerMenus();
                    const nuevoMenu = {
                        id: Date.now(),
                        url: data.data.url,
                        deleteUrl: data.data.delete_url,
                        fecha: new Date().toISOString(),
                        activo: true
                    };

                    // Desactivar otros men√∫s
                    menus.forEach(m => m.activo = false);
                    menus.push(nuevoMenu);
                    guardarMenus(menus);

                    // Mostrar √©xito
                    statusMsg.style.display = 'block';
                    statusMsg.style.background = '#d4edda';
                    statusMsg.style.color = '#155724';
                    statusMsg.textContent = '‚úÖ Foto subida correctamente y visible en todos los dispositivos';

                    // Actualizar vista
                    mostrarMenuPublico();
                    cargarGaleriaMenus();

                } else {
                    throw new Error('Error al subir la imagen');
                }

            } catch (error) {
                console.error('Error:', error);
                statusMsg.style.display = 'block';
                statusMsg.style.background = '#f8d7da';
                statusMsg.style.color = '#721c24';
                statusMsg.textContent = '‚ùå Error al subir la foto. Int√©ntalo de nuevo.';
            } finally {
                // Restaurar UI
                uploadLabel.classList.remove('uploading');
                uploadText.textContent = 'üì§ Subir nueva foto del men√∫';
                input.value = '';
            }
        }

        function cargarGaleriaMenus() {
            const gallery = document.getElementById('menuGallery');
            const menus = obtenerMenus();

            if (menus.length === 0) {
                gallery.innerHTML = '<div class="no-menus-msg">No hay fotos de men√∫ subidas a√∫n.</div>';
                return;
            }

            gallery.innerHTML = menus
                .sort((a,b) => new Date(b.fecha) - new Date(a.fecha))
                .map(menu => {
                    const fecha = new Date(menu.fecha).toLocaleDateString('es-ES', { 
                        day: 'numeric', 
                        month: 'short',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    return `
                        <div class="menu-gallery-item">
                            ${menu.activo ? '<div class="active-badge">‚úÖ ACTIVO</div>' : ''}
                            <img src="${menu.url}" alt="Men√∫ ${fecha}" onclick="activarMenu(${menu.id})">
                            <button class="delete-img-btn" onclick="eliminarMenu(${menu.id})" title="Eliminar">üóëÔ∏è</button>
                        </div>
                    `;
                }).join('');
        }

        function activarMenu(id) {
            const menus = obtenerMenus();
            menus.forEach(m => m.activo = (m.id === id));
            guardarMenus(menus);
            mostrarMenuPublico();
            cargarGaleriaMenus();
        }

        function eliminarMenu(id) {
            if (!confirm('¬øEliminar esta foto del men√∫?')) return;

            const menus = obtenerMenus();
            const menuAEliminar = menus.find(m => m.id === id);

            // Si era el activo, activar el m√°s reciente
            if (menuAEliminar && menuAEliminar.activo) {
                const nuevosMenus = menus.filter(m => m.id !== id);
                if (nuevosMenus.length > 0) {
                    nuevosMenus[0].activo = true;
                }
                guardarMenus(nuevosMenus);
            } else {
                guardarMenus(menus.filter(m => m.id !== id));
            }

            mostrarMenuPublico();
            cargarGaleriaMenus();
        }

        function mostrarMenuPublico() {
            const menus = obtenerMenus();
            const menuActivo = menus.find(m => m.activo);
            const img = document.getElementById('menuDiarioImg');
            const msg = document.getElementById('noMenuMsg');

            if (!img || !msg) return;

            if (menuActivo) {
                img.src = menuActivo.url;
                img.style.display = 'block';
                msg.style.display = 'none';
            } else {
                img.style.display = 'none';
                msg.style.display = 'block';
            }
        }

        function calcularOcupacion(fecha, turno) {
            const reservas = obtenerReservas();
            const horasMediodia = ['13:00','13:30','14:00','14:30','15:00','15:30'];
            const horasNoche = ['20:00','20:30','21:00','21:30','22:00','22:30'];
            const horasFiltro = turno === 'mediodia' ? horasMediodia : horasNoche;
            return reservas
                .filter(r => r.fecha === fecha && horasFiltro.includes(r.hora) && r.estado === 'confirmada')
                .reduce((sum, r) => sum + (r.personas === 'mas8' ? 10 : parseInt(r.personas)), 0);
        }
        function obtenerEstadoTurno(ocupacion) {
            if (ocupacion >= UMBRAL_ROJO) return 'full';
            if (ocupacion >= UMBRAL_NARANJA) return 'partial';
            return 'available';
        }

        function actualizarHorasDisponibles() {
            const fecha = document.getElementById('fecha').value;
            const horaSelect = document.getElementById('hora');
            if (!fecha) return;
            horaSelect.innerHTML = '<option value="">Selecciona hora</option>';

            const ocupacionMediodia = calcularOcupacion(fecha, 'mediodia');
            const ocupacionNoche = calcularOcupacion(fecha, 'noche');
            const disponibleMediodia = CAPACIDAD_MEDIODIA - ocupacionMediodia;
            const disponibleNoche = CAPACIDAD_NOCHE - ocupacionNoche;

            const mediodia = document.createElement('optgroup');
            mediodia.label = `Mediod√≠a (${disponibleMediodia}/${CAPACIDAD_MEDIODIA})`;
            const cena = document.createElement('optgroup');
            cena.label = `Cena (${disponibleNoche}/${CAPACIDAD_NOCHE})`;

            if (disponibleMediodia > 0) ['13:00','13:30','14:00','14:30','15:00','15:30'].forEach(h => { const o=document.createElement('option'); o.value=h; o.textContent=h; mediodia.appendChild(o); });
            if (disponibleNoche > 0) ['20:00','20:30','21:00','21:30','22:00','22:30'].forEach(h => { const o=document.createElement('option'); o.value=h; o.textContent=h; cena.appendChild(o); });
            if (mediodia.children.length) horaSelect.appendChild(mediodia);
            if (cena.children.length) horaSelect.appendChild(cena);
        }

        function enviarReserva(event) {
            event.preventDefault();
            const nombre = document.getElementById('nombre').value;
            const prefijo = document.getElementById('prefijo').value;
            const telefono = document.getElementById('telefono').value;
            const fecha = document.getElementById('fecha').value;
            const hora = document.getElementById('hora').value;
            const personasVal = document.getElementById('personas').value;
            const comentarios = document.getElementById('comentarios').value;

            if (telefono.length !== 9) { alert('‚ùå El tel√©fono debe tener 9 d√≠gitos'); return; }

            const reservas = obtenerReservas();
            reservas.push({
                id: Date.now(),
                nombre,
                telefono: prefijo + telefono,
                fecha,
                hora,
                personas: personasVal,
                comentarios,
                estado: 'pendiente',
                timestamp: new Date().toISOString()
            });
            guardarReservas(reservas);
            window.open(`https://wa.me/34669670985?text=${encodeURIComponent('Reserva:\n' + nombre + '\n' + prefijo + telefono + '\n' + fecha + ' ' + hora + '\n' + personasVal + ' personas' + (comentarios ? '\n' + comentarios : ''))}`, '_blank');
            document.getElementById('reservaForm').reset();
        }

        function cargarDatosAdmin() {
            generarCalendario();
            mostrarListaReservas();
        }

        function generarCalendario() {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            const hoy = new Date();
            for (let i=0;i<30;i++) {
                const fecha = new Date(hoy); fecha.setDate(hoy.getDate()+i);
                const fechaStr = fecha.toISOString().split('T')[0];
                const ocupacionMediodia = calcularOcupacion(fechaStr,'mediodia');
                const ocupacionNoche = calcularOcupacion(fechaStr,'noche');
                const estadoMediodia = obtenerEstadoTurno(ocupacionMediodia);
                const estadoNoche = obtenerEstadoTurno(ocupacionNoche);

                const div = document.createElement('div');
                div.className = 'calendar-day-card';
                div.setAttribute('data-fecha', fechaStr);
                div.onclick = function(){ mostrarReservasDia(fechaStr); };

                const emoji = s => s==='full'?'üî¥':(s==='partial'?'üü†':'üü¢');
                div.innerHTML = `
                    <div class="calendar-day-header">
                        <strong>${fecha.getDate()}</strong>
                        <small>${fecha.toLocaleDateString('es-ES',{weekday:'short',month:'short'})}</small>
                    </div>
                    <div class="calendar-turnos">
                        <div class="turno-status ${estadoMediodia}">${emoji(estadoMediodia)} COMIDA<br><small>${ocupacionMediodia}/${CAPACIDAD_MEDIODIA}</small></div>
                        <div class="turno-status ${estadoNoche}">${emoji(estadoNoche)} CENA<br><small>${ocupacionNoche}/${CAPACIDAD_NOCHE}</small></div>
                    </div>
                `;
                grid.appendChild(div);
            }
        }

        function mostrarReservasDia(fecha) {
            document.querySelectorAll('.calendar-day-card').forEach(d=>d.classList.remove('selected'));
            const card = document.querySelector(`[data-fecha="${fecha}"]`);
            if (card) card.classList.add('selected');

            const reservas = obtenerReservas().filter(r=>r.fecha===fecha);
            const horasMediodia = ['13:00','13:30','14:00','14:30','15:00','15:30'];
            const mediodia = reservas.filter(r=>horasMediodia.includes(r.hora));
            const noche = reservas.filter(r=>!horasMediodia.includes(r.hora));

            const render = (arr) => arr.length ? arr.sort((a,b)=>a.hora.localeCompare(b.hora)).map(r=>`
                <div class="reservation-mini ${r.estado}">
                    <div><strong>${r.hora} - ${r.nombre}</strong><small>‚òéÔ∏è ${r.telefono} | üë• ${r.personas}</small></div>
                    <div>${r.estado==='pendiente' ? `<button class="confirm-btn" onclick="confirmarReserva(${r.id})">‚úÖ</button>` : '<span class="estado-badge confirmada">üü¢</span>'}</div>
                </div>
            `).join('') : '<p style="color:#999;">Sin reservas</p>';

            document.getElementById('reservasMediodia').innerHTML = render(mediodia);
            document.getElementById('reservasNoche').innerHTML = render(noche);
            document.getElementById('dayReservations').classList.add('show');
        }

        function confirmarReserva(id) {
            const reservas = obtenerReservas().map(r=> r.id===id ? ({...r, estado:'confirmada'}) : r );
            guardarReservas(reservas);
            cargarDatosAdmin();
        }

        function mostrarListaReservas() {
            const lista = document.getElementById('reservationsList');
            const reservas = obtenerReservas().sort((a,b)=> (a.fecha===b.fecha ? a.hora.localeCompare(b.hora) : a.fecha.localeCompare(b.fecha)));
            if (!reservas.length) { lista.innerHTML = '<p style="text-align:center;color:#999;">No hay reservas</p>'; return; }
            lista.innerHTML = reservas.map(r=>`
                <div class="reservation-item ${r.estado}">
                    <div><strong>${r.nombre} - ${r.fecha} ${r.hora}</strong><small>‚òéÔ∏è ${r.telefono} | üë• ${r.personas}</small></div>
                    <div style="display:flex; gap:0.5rem;">
                        ${r.estado==='pendiente' ? `<button class="confirm-btn" onclick="confirmarReserva(${r.id})">‚úÖ</button>` : '<span class="estado-badge confirmada">üü¢</span>'}
                        <button class="delete-btn" onclick="eliminarReserva(${r.id})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function eliminarReserva(id) {
            if (!confirm('¬øEliminar?')) return;
            guardarReservas(obtenerReservas().filter(r=>r.id!==id));
            cargarDatosAdmin();
        }

        document.addEventListener('DOMContentLoaded', function(){
            const fechaInput = document.getElementById('fecha');
            const hoy = new Date().toISOString().split('T')[0];
            fechaInput?.setAttribute('min', hoy);
            mostrarMenuPublico();
        });
    </script>
</body>
</html>
